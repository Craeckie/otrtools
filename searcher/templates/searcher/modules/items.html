{% load item_tags %}

{% for item in items %}
<tr{% if not forloop.first %} class="collapse collapse-{{ num }}"{% endif %}>
  <td><a target="_blank" href="https://otrkeyfinder.com/en/?search={{ item.file }}&order=date-name"><span class="badge badge-{{ item.format|format2label }}">{{ item.format }}</span> {{ item.title }}</a></td>
  <td>{{ item.length }}</td>
  <td>{{ item.item_count }}</td>
</tr>
<tr{% if not forloop.first %} class="collapse collapse-{{ num }}"{% endif %}>
  <td>
    <table class="table">
      {% for m in item.mirrors %}
      <tr>
        <td><a target="_blank" href="{{ m.link }}">{{ m.name }}</a></td>
      </tr>
      {% empty %}
          No mirrors found! :(
      {% endfor %}
    </table>
  </td>
  <td>
    <table style="table-layout: fixed; width: 100%" class="table" id="cutlist-table-{{ num }}-{{ forloop.counter }}">
      {% if item.isDecoded or hide_cutlists %}
        <tr><td>Already decoded. <a href="javascript:{% cutlist_call item forloop.counter num destName True %}">Load cutlists anyway?</a></td></tr>
      {% endif %}
    </table>
    <script>
      {% if item.file_decrypted and forloop.first and not item.isDecoded and not hide_cutlists %}
        {% cutlist_call item forloop.counter num destName %};
      {% elif not forloop.first %}
        $('.collapse-{{ num }}:first').on('show.bs.collapse', function() {
          $('#more-{{ num }}').remove();

          {% cutlist_call item forloop.counter num destName %};
        });
      {% endif %}
    </script>

  </td>
</tr>
{% if forloop.first and items|length > 1 %}
<tr id="more-{{ num }}">
  <td><a class="btn btn-primary" data-toggle="collapse" data-target=".collapse-{{ num }}" role="button" aria-expanded="false" aria-controls="collapse-{{ num }}"> ({{ items|length|add:"-1" }}) More..</a></td>
</tr>
{% endif %}
{% endfor %}
